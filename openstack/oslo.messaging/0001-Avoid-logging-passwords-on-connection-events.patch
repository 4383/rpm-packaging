From 4b568352eb9498edac70c428e8638f50bb034789 Mon Sep 17 00:00:00 2001
From: Kenneth Giusti <kgiusti@gmail.com>
Date: Mon, 20 Aug 2018 12:31:16 -0400
Subject: [PATCH] Avoid logging passwords on connection events

Change-Id: I15c8c4a1177c363283281d2fed63545658eda5de
Closes-Bug: #1787214
(cherry picked from commit d9866029a2aab2c5f001100813c0425b4905fdf6)
---
 oslo_messaging/_drivers/impl_rabbit.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

Index: oslo.messaging-5.10.2/oslo_messaging/_drivers/impl_rabbit.py
===================================================================
--- oslo.messaging-5.10.2.orig/oslo_messaging/_drivers/impl_rabbit.py
+++ oslo.messaging-5.10.2/oslo_messaging/_drivers/impl_rabbit.py
@@ -1168,7 +1168,9 @@ class Connection(object):
             self.ensure(method, retry=retry, error_callback=_error_callback)
 
     def _get_connection_info(self):
-        info = self.connection.info()
+        ci = self.connection.info()
+        info = dict([(k, ci.get(k)) for k in
+                     ['hostname', 'port', 'transport']])
         client_port = None
         if self.channel and hasattr(self.channel.connection, 'sock'):
             client_port = self.channel.connection.sock.getsockname()[1]
