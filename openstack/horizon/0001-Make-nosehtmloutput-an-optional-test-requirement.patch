From 8d7b2ce3c084681f95107f3160eb0f7bf4d8b550 Mon Sep 17 00:00:00 2001
From: Thomas Bechtold <tbechtold@suse.com>
Date: Mon, 21 Aug 2017 14:50:05 +0200
Subject: [PATCH] Make nosehtmloutput an optional test requirement

It is not strictly needed.

Change-Id: I37b2623ec834533a7ecae63084e2c2c04ecc1751
---
 horizon/test/settings.py | 7 ++++++-
 setup.cfg                | 4 ++++
 test-requirements.txt    | 1 -
 tox.ini                  | 2 +-
 4 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/horizon/test/settings.py b/horizon/test/settings.py
index fde7c1269..c48d74fee 100644
--- a/horizon/test/settings.py
+++ b/horizon/test/settings.py
@@ -116,7 +116,12 @@ NOSE_ARGS = ['--nocapture',
              '--all-modules']
 # TODO(amotoki): Need to investigate why --with-html-output
 # is unavailable in python3.
-if six.PY2:
+try:
+    import htmloutput  # noqa: F401
+    has_html_output = True
+except ImportError:
+    has_html_output = False
+if six.PY2 and has_html_output:
     NOSE_ARGS += ['--with-html-output',
                   '--html-out-file=ut_horizon_nose_results.html']
 
diff --git a/setup.cfg b/setup.cfg
index 8bf20b48b..d6582621f 100644
--- a/setup.cfg
+++ b/setup.cfg
@@ -22,6 +22,10 @@ classifier =
     Programming Language :: Python :: 3.5
     Topic :: Internet :: WWW/HTTP
 
+[extras]
+test =
+    nosehtmloutput>=0.0.3 # Apache-2.0
+
 [global]
 setup-hooks =
     openstack_dashboard.hooks.setup_hook
diff --git a/test-requirements.txt b/test-requirements.txt
index 6015f77ac..2176e0c3e 100644
--- a/test-requirements.txt
+++ b/test-requirements.txt
@@ -18,7 +18,6 @@ mox3!=0.19.0,>=0.7.0 # Apache-2.0
 nodeenv>=0.9.4 # BSD
 nose # LGPL
 nose-exclude # LGPL
-nosehtmloutput>=0.0.3 # Apache-2.0
 nosexcover # BSD
 openstack.nose-plugin>=0.7 # Apache-2.0
 openstackdocstheme>=1.16.0 # Apache-2.0
diff --git a/tox.ini b/tox.ini
index 433e46fef..9a030bc61 100644
--- a/tox.ini
+++ b/tox.ini
@@ -13,7 +13,7 @@ setenv =
 whitelist_externals =
   bash
   find
-deps =
+deps = .[test]
   -r{toxinidir}/requirements.txt
   -r{toxinidir}/test-requirements.txt
 commands =
-- 
2.14.1

